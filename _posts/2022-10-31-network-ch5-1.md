---
layout: post
title: "计网 Ch5：运输层-1"
author: LJC
tags:
- network
date: 2022-10-31 13:12 +0800
toc: true
---

# 运输层 (Transport layer) - Part1

此前所介绍的 物理层，数据链路层，网络层 共同解决了将主机通过异构网络互连起来所面临的问题，**实现了主机到主机的通信**。但实际上，在计算机网络中**进行通信的真正实体是 位于通信两端主机中的进程**。

![tl01.png](/images/net/tl01.png "TL")

## 1. 运输层：为进程通信提供服务

【运输层的任务】：为应用进程的通信提供服务，即**如何运行在不同主机上的应用进程提供直接的通信服务是运输层的任务**，运输层协议又称为端到端协议，应用范围是 **进程到进程，即【端到端】**。

![tl02.png](/images/net/tl02.png "TL2")
 
注意图中的虚线，表示数据的传输方向。如图，不同的进程如何区分？ 

**运输层使用不同的端口来对应不同的应用进程**，然后通过网络层及下层来传输报文。接收方的运输层**通过不同端口**，将收到的应用层报文交付给应用层中相应的应用进程。这里的【**端口**】并不是物理意义上的实体端口，而是指用来**区分不同应用进程**的**标识符**。

> 为了简单起见，在学习运输层时，简单地认为**运输层直接为 应用进程间的逻辑通信提供服务**。


运输层向高层用户屏蔽了下面网络核心的细节（如网络拓扑，路由选择协议等），它让进程看见的就好像两个运输层实体之间有一条端到端的逻辑通信信道。根据应用需求的不同，运输层为应用层提供了两种不同的运输协议，即 **面向连接的 TCP 和无连接的 UDP** ，这两种协议就是运输层的主要内容。

### 端到端 和 点到点

**端到端 end-to-end** ：假设将数据从A传送到E，中间可能经过 **A**→B→C→D→**E**，但运输层并不知道 B/C/D 的存在。对它来说：从A传送到E，那只关注A和E（两端），只认为报文数据是从一端 A 到另一端 E 的，这就是端到端。
- 如图中蓝色的逻辑直连通道
- ![tl03.png](/images/net/tl03.png "端到端")

**点到点**：以网络层为例，它要关心从A点去往下一个点（涉及到路由选择等）

端到端和点到点的区别与联系：
- 端到端由若干的点到点实现和组成，它是建立在点到点的基础之上的。
- 直白说，**传输层及以上使用端到端**，**网络层及以下使用点到点传输**。
    - （路由器是分水岭，它最高到网络层）
- 从 点到点 到 端到端，也是封装的体现；

------

## 2. 运输层端口号，复用与分用

### 端口号

> 运输层为进程通信提供服务，不同进程用不同端口号区分。

在 PC 上，不同进程用 **进程标识符 PID** 来区分。但因特网上的主机运行的不同操作系统（Win，Mac，Linux，Unix）使用的**进程标识符格式也不同**。那么，为了让进程之间通信，就要**统一对 TCP/IP 体系的应用进程 作标识**。

TCP/IP 体系的运输层使用 **端口号** 来区分 应用层的不同应用进程。
- **端口号（16 bit）**：取值范围 **0~65535** ，【3种】

    - 熟知端口号：0~1023，指派给 TCP/IP 体系中最重要的一些应用协议，如 FTP(21/20)，HTTP(80)，DNS(53)；

    - 登记端口号：1024~49151，为没有熟知端口号的应用程序使用。使用必须在互联网协会登记，防止重复。如 Microsoft RDP 远程桌面使用 3389 ，MySQL (3306) 。
    
    - 短暂端口号：49152~65535，留给客户进程选择暂时使用。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的动态端口号，通信结束后该端口号可供其他客户进程以后使用。

- 注意，**端口号只具有本地意义**，即端口号只是为了（在TCP/IP体系下）**标识本计算机应用层中的各进程**，在因特网中，**不同计算机中的相同端口号是没有联系的**。

-----------

### 发送方的复用和接收方的分用

如下图：

- 对发送方而言：
    - 运输层：不同端口号的应用进程 **复用（都用）** **UDP 和 TCP 协议**封装，再交给网络层；
    - ↓
    - 网络层：UDP用户数据报 和 TCP报文 **复用（都用）** IP 协议 封装成 IP 数据报；
        - IP 数据报头中 协议字段表明该数据载荷是运输层用的哪个协议数据单元（6/17）；

- ![tl04.png](/images/net/tl04.png "发送方的复用和接收方的分用")

- 对接收方而言：
    - 网络层： IP 数据报 分用（分别用） IP 协议 上交给 UDP 和 TCP ；
        - 依然由 IP 数据报头中 协议字段表明该数据载荷是运输层用的哪个协议数据单元（6/17）区分；
    - ↓
    - 运输层：UDP和TCP **分用（分别用）** 不同端口号，把数据交付给上层相应的应用进程；





