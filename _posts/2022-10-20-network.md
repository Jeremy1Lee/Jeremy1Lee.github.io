---
layout: post
title: "计算机网络（一）"
author: LJC
tags:
- network
date: 2022-10-20 15:10 +0800
toc: true
---
{: .message }
## 网络概述

### 1. 网络，互连（联）网，因特网

**网络（Network）**由**结点（Node）**和连接它们的**链路（Link）**组成。

![net01.png](/images/net/net01.png "网络和互联网"){: .align-center}

小网络由**路由器**互联，形成范围更大的网络，即网络的网络。最终，互联网是最大的网络。小写的 internet 是一个通用名词，泛指多个计算机网络互联而成的网络，这些网络之间的通信协议可以是任意的，而因特网 Internet 是一个专用名词，采用 **TCP/IP** 协议族作为通信的规则。

ISP（Internet Service Provider）：网络服务提供商，普通用户通过 ISP 提供的 IP 地址接入互联网。我国的ISP：电信，移动，联通。如图，一旦某个用户能够接入到互联网，他也可以成为一个ISP，购置 调制解调器和路由器 ，让其他用户和他相连。因此很容易添加新的分支。ISP的网络结构如下：

![net02.png](/images/net/net02.png "ISP的网络结构"){: .align-center}

路由器在网络中起核心作用，是一种专用计算机，但不是主机，实现分组交换的关键构建，任务是转发收到的分组。

### 2. 三种交换方式：电路交换，分组交换和报文交换

电话机，如果全世界的电话都两两相连，需要无穷的电话线。我们直接搞一种分接设备，在里面让线拐弯不就行了？让需要通信的任意两部电话线路按需接通。如果电话进一步增加，就相应增加电话交换机的数量，来完成交换任务，构成电信网。

![cir01.png](/images/net/cir01.png "从电话线讲起"){: .align-center}

![cir02.png](/images/net/cir02.png "电话线"){: .align-center}

从通信资源分配的角度看，交换（Switching）就是按某种方式动态分配传输线路的资源。

1）电路（Circuit）交换：电路交换可以实现计算机数据传输，但效率很低，因为计算机数据是突发的，每次都得等分配，所以计算机网络常采用分组交换。**分三步：建立连接，通话，释放连接。**

![cir03.png](/images/net/cir03.png "电路交换"){: .align-center}

2）分组（Packet）交换：**最重要的分组交换机是路由器**，将各种网络互连（如图），并对接收到的分组进行转发，也就是进行分组交换。如图，得到报文先分组，然后添加首部。

![cir04.png](/images/net/cir04.png "分组交换"){: .align-center}

**报文：表示消息的整块数据称为一个报文**。

为什么要不惜额外数据量添加**报头**？显然这种网络结构不像两两直连那样明确发给谁，所以报头里一定要包含**各分组目的地址**的信息，便于分组转发（真就是字面意思，分组+转发）。看图，分组交换机（路由器）收到分组后，先暂时将分组存储，再检查其首部，按目的地址进行查表转发，找到合适的转发接口，通过接口将分组转发给下一个分组交换机。总结就是：

- 消息发送方：构造分组，发送分组；
- 路由器（分组交换机）：缓存分组，转发分组；
- 消息接收方：接收分组，还原报文；

3）报文（Message）交换：对报文大小没有限制（不分组），现在较少使用。

![sum01.png](/images/net/sum01.png "总结"){: .align-center}

总结：图中看出，分组交换比报文交换减少了时延（报文交换需要缓存时间，分组交换利用缓存的时间，边缓存边转发，利用率更高）。

电路交换的优点：
- 1）通信时延小，因为线路是双方专用的，且直达。当连续传大量数据时很明显。
- 2）有序传输，只走这一条路，不会失序（由于网络结构，不同分组则会走不同路，可能失序）；
- 3）没有冲突；

但是缺点：
- 1）建立连接时间长
- 2）使用效率低
- 3）灵活性差，坏了一个就不好用了
- 4）难以规格化，难以差错控制

分组交换优点：
- 1）无需建立连接
- 2）线路利用率高
- 3）简化存储管理，因为分组长度固定
- 4）后一个分组的存储和前一个的转发同步进行
- 5）减少重发数据量，可靠性和时延++

但是缺点：
- 1）有转发时延，但已经比报文交换小了
- 2）额外信息量（源地址，目的地址等控制信息）
- 3）可能出现失序，丢失，重复分组问题

### 3. 计算机网络的定义和分类

简单定义：**互连**的，**自治**的计算机集合。互连：有线/无线；自治：独立，可以单独运行；集合：至少要两台计算机。定义：计算机网络由一些通用的，可编程的硬件**互联**而成，并非专门用来实现某一目的，可传送多种不同类型数据。

按交换技术分类：电路交换，分组交换和报文交换；

按覆盖范围分类：
- <mark>广域网 WAN</mark> ：几十到几千公里，互连城域网和局域网
- <mark>城域网 MAN</mark> ：5-50公里，覆盖城市，互连企业，机构，校园局域网
- <mark>局域网 LAN</mark> ：1 公里左右，楼，实验室
- <mark>个域网 PAN</mark> ：10 米，不连接普通计算机，而是个人电子设备

按拓扑结构分类：
- 总线型网络：用一根传输线把计算机连起来，建网容易，增减方便，节省线路，但一处故障全网瘫痪。
- 星型网络：中间一般是交换机和路由器，便于管理，但中间对故障敏感。
- 环形网络：环中信号单向传输。
- 网状型网络：每个结点至少由两条路径与其他结点相连，多用于广域网，可靠性高但复杂

### 4. 计算机网络的性能指标

首先明确单位：**8 bit （比特） = 1 Byte （字节）**

1 KB = 1024(2^10) Byte    ，  1 MB = 1024(2^10) KB；

8 个常用指标：

- 1） **速率 Data rate**：连接在计算机网络上的主机在数字信道上传送比特的速率，也称比特率(bit rate) 或数据率。单位bit/s, bps, kb/s = 10^3 b/s

![bit01.png](/images/net/bit01.png "bit"){: .align-center}

- 2）**带宽 Bandwidth**，在信号处理和计算机网络中的定义不同：

在**模拟信号**中：信号所包含的各种不同频率成分所占据的**频率范围**（如频谱图中的山峰），单位 Hz 。

在**计算机网络**中：网络的**通信线路传送数据的能力**。网络带宽表示单位时间内网络中一点到另一点能通过的**最高数据率**，单位 **b/s** , kb/s 。作为数据传输的上限，直接关系到网络应用体验。

- 3）**吞吐量 Throughput**：**单位时间内通过某个网络（或信道，接口）的数据量**。即实际网络中有多少数据量通过，受带宽和额定速率的限制，小于带宽

- 4）**时延 Delay**

分组从 源主机 送到 目的主机 的全过程，有以下三种时延：

① 源主机将分组发往传输线路 —— **发送时延**

② 代表分组的电信号在链路上传输花费的时间 —— **传播时延**

③ 路由器收到分组后存储转发 —— 处理（排队）时延

由于路线上有多个路由器和多段线路，这些时延将不止一次出现，关于时延的计算如图：路由器受网络动态变化，软硬件性能不同影响不好计算。关于两种时延哪个在主导并不能确定，看公式，这取决于分组长度和距离。

![delay01.png](/images/net/delay01.png "时延"){: .align-center}

- 5) **时延带宽积 Bandwidth-Delay Product**：**传播时延(s) × 带宽(bit/s)**。从公式来看，它表示如果连续发送数据，表示第一个 bit 到达目的地时已经发送了多少 bit 。链路的时延带宽积又称为**以比特为单位的链路长度**，即原来的长度是物理意义上的，我走100km才到，时延带宽积是我发送这么多，才有 bit 陆续到达目的地。

- 6）**往返时间 Round-Trip Time**：因特网上的信息不仅单方向传输，而是双向交互。从源主机发送分组开始，直到源主机收到来自目的主机的确认分组为止，如下图从以太网 host 到 LAN 的往返时间。

![rtt.png](/images/net/rtt.png "RTT"){: .align-center}

- 7）**利用率**：分为信道利用率和网络利用率。

**信道利用率** 表示某信道有百分之几的时间是被利用（有数据通过）的。

**网络利用率** 表示全网络信道利用率的加权平均。

![usage.png](/images/net/usage.png "RTT"){: .align-center}

根据排队论，某信道利用率增大，该信道引起的时延也会迅速增加（原因如上图），因此道利用率并非越大越好。一般控制不超过50%，如果超过了就要增大线路带宽。也不能太低，会浪费。应该使用一些机制动态调整网络通信量，使利用率保持合理。

- 8）**丢包率 Packet loss**，即**分组丢失率**

指一定时间范围内，**传输过程中丢失的分组数量与总分组数**。具体可分为接口丢包率，结点丢包率，链路丢包率，路径丢包率，网络丢包率等。运维人员非常关心，但普通用户并不能意识到。

分组丢失主要有两种情况：一是分组在传输过程中出现误码，被结点交换机检测出并丢弃；二是网络拥塞，即分组到达一台队列已满的分组交换机时被丢弃，通信量较大时就可能造成网络拥塞。比如某路由器的缓存区已满（或达到自身阈值），再有分组到达该路由器就只能丢弃。因此，丢包率反映了**网络的拥塞情况**，无拥塞时丢包率为 0 ，轻度为 1%-4% ，严重为 5%-15% ，丢包较高则网络应用无法正常工作。
















